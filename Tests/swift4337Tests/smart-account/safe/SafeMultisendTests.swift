//
//  SafeMultisendTests.swift
//
//
//  Created by Frederic DE MATOS on 16/07/2024.
//


import XCTest
import web3
import BigInt
@testable import swift4337

class SafeMultisendTests: XCTestCase {
    
    func testMultiSendTransctionPackIsOk() async throws {
        let tx = MultiSendTransaction(op: BigUInt(1), to: EthereumAddress("0x07D607c057727665377c8D48260DdC98bd9e1Bf3"), data: "0x8d0dc49f00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000a4377d2a94d9bf0fcdf59387136f21abe63b14aa".web3.hexData!)

        let expected = "0x0107d607c057727665377c8d48260ddc98bd9e1bf3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000648d0dc49f00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000a4377d2a94d9bf0fcdf59387136f21abe63b14aa"
        
        XCTAssertEqual(try tx.pack().web3.hexString, expected)
        
    }
    
    func testMultiSendTransactionsPackIsOk() async throws {
        
        let tx1 = MultiSendTransaction(op: BigUInt(1), to: EthereumAddress("0x07D607c057727665377c8D48260DdC98bd9e1Bf3"), data: "0x8d0dc49f00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000a4377d2a94d9bf0fcdf59387136f21abe63b14aa".web3.hexData!)
        
        let tx2 = MultiSendTransaction(op: 1, to: EthereumAddress("0xB3a6Aa3eDDD715dbD84aD465Ab0f98919eBB6d5C"), data: "0x0dd9692f1ab14ec9cc033b09402c2dcec6099336d142c155f7e83a59fe6dd4cb08a5cbdd0a3413ca47bef7b8822cf85e16ddf3df2ed08b5a52a159be833dfb058a1018dd000000000000000000000000fbe0614ffb2226cd6d1d3f9a79bc73d7647b4c61".web3.hexData!)
        
        let expected = "0x0107d607c057727665377c8d48260ddc98bd9e1bf3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000648d0dc49f00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000a4377d2a94d9bf0fcdf59387136f21abe63b14aa01b3a6aa3eddd715dbd84ad465ab0f98919ebb6d5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000640dd9692f1ab14ec9cc033b09402c2dcec6099336d142c155f7e83a59fe6dd4cb08a5cbdd0a3413ca47bef7b8822cf85e16ddf3df2ed08b5a52a159be833dfb058a1018dd000000000000000000000000fbe0614ffb2226cd6d1d3f9a79bc73d7647b4c61"
        
        let packedMultiTx = try [tx1, tx2].pack().web3.hexString
        
        XCTAssertEqual(packedMultiTx, expected)
        
    }
}
